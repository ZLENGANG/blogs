(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{448:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h4",{attrs:{id:"_1-执行机-executor"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-执行机-executor"}},[t._v("#")]),t._v(" 1. 执行机（"),s("strong",[t._v("Executor")]),t._v("）")]),t._v(" "),s("p",[t._v("运行程序的机器")]),t._v(" "),s("ul",[s("li",[t._v("安装nodejs")])]),t._v(" "),s("div",{staticClass:"language-PowerShell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1、下载nodejs")]),t._v("\nwget https:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nodejs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org/dist/v14"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("17"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4/node-v14"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("17"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4-linux-x64"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2、解压nodejs")]),t._v("\ntar "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("xvf node-v14"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("17"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4-linux-x64"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3、修改文件夹名字，在xftp内完成即可")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4、建立软链接")]),t._v("\n$ ln "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/local/nodejs/bin/node "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/local/bin\n$ ln "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/local/nodejs/bin/npm "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/local/bin\n\n")])])]),s("p",[t._v("参考链接："),s("a",{attrs:{href:"https://blog.csdn.net/weixin_43820866/article/details/103683322",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.csdn.net/weixin_43820866/article/details/103683322"),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[t._v("安装git")])]),t._v(" "),s("div",{staticClass:"language-PowerShell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y install git\ngit "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("version\n\n")])])]),s("ul",[s("li",[t._v("安装nginx，用于访问已打包好的前端项目")])]),t._v(" "),s("p",[t._v("详情：安装nginx")]),t._v(" "),s("h4",{attrs:{id:"_2-在平台上下载并安装gitlab-runner命令行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-在平台上下载并安装gitlab-runner命令行"}},[t._v("#")]),t._v(" "),s("strong",[t._v("2. 在平台上下载并安装Gitlab-runner命令行")])]),t._v(" "),s("div",{staticClass:"language-PowerShell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装")]),t._v("\nsudo curl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("L "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("output "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/local/bin/gitlab-runner "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置权限")]),t._v("\nsudo chmod "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/local/bin/gitlab-runner\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 初始化gitlab-runner")]),t._v("\ncd ~\ngitlab-runner install\ngitlab-runner "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),t._v("\n\n")])])]),s("h4",{attrs:{id:"_3-注册runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-注册runner"}},[t._v("#")]),t._v(" 3. 注册Runner")]),t._v(" "),s("div",{staticClass:"language-PowerShell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注册")]),t._v("\nsudo gitlab-runner register\n")])])]),s("p",[s("img",{attrs:{src:"/git%E7%9B%B8%E5%85%B3/gitlab-ci%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96-1.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"_4-激活runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-激活runner"}},[t._v("#")]),t._v(" 4. 激活Runner")]),t._v(" "),s("div",{staticClass:"language-PowerShell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("sudo gitlab-runner verify\n")])])]),s("h4",{attrs:{id:"_5-gitlab-ci-yml文件配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-gitlab-ci-yml文件配置"}},[t._v("#")]),t._v(" 5.  .gitlab-ci.yml文件配置")]),t._v(" "),s("div",{staticClass:"language-YAML extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分段")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" install\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" deploy\n \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 缓存")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node_modules\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dist\n \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("install-job")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" report"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ui"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1118")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm config set registry https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//registry.npm.taobao.org \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm install\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" main\n \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build-job")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" report"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ui"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1118")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm run build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" main\n \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy-job")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" report"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ui"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1118")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo $USER\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" scp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("r ./dist root@190.92.233.13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/home/nginx/html/report"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ui\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" main\n")])])]),s("h4",{attrs:{id:"_6-解决卡在deploy问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-解决卡在deploy问题"}},[t._v("#")]),t._v(" 6. 解决卡在deploy问题")]),t._v(" "),s("p",[t._v("若出现如下问题：（原因：未进行免交互认证）")]),t._v(" "),s("p",[s("img",{attrs:{src:"/git%E7%9B%B8%E5%85%B3/gitlab-ci%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96-2.png",alt:""}})]),t._v(" "),s("p",[t._v("使用以下方法解决：")]),t._v(" "),s("div",{staticClass:"language-PowerShell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看gitlab-runner使用的用户")]),t._v("\n在"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gitlab-ci"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yml中打印"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$USER")]),t._v("，输出gitlab-runner\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务器中切换为gitlab-runner账号")]),t._v("\nsu "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" gitlab-runner\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建免交互密钥对")]),t._v("\nssh-keygen\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 复制密钥对")]),t._v("\nssh-"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("copy-id")]),t._v(" root@190"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("92"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("233"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("13\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);